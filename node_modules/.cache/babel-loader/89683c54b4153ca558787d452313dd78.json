{"ast":null,"code":"import * as conf from './conf';\nimport * as perso from './game';\nconst dist2 = (o1, o2) => Math.pow(o1.x - o2.x, 2) + Math.pow(o1.y - o2.y, 2);\nconst iterate = player => bound => ball => {\n  const invincible = ball.invincible ? ball.invincible - 1 : ball.invincible;\n  const coord = ball.coord;\n  const dx = (coord.x + conf.RADIUS > bound.width || coord.x < conf.RADIUS ? -coord.dx : coord.dx) * conf.FRICTION;\n  const dy = (coord.y + conf.RADIUS > bound.height || coord.y < conf.RADIUS ? -coord.dy : coord.dy) * conf.FRICTION;\n  if (Math.abs(dx) + Math.abs(dy) < conf.MINMOVE) return {\n    ...ball,\n    invincible,\n    coord: {\n      ...coord,\n      dx: 0,\n      dy: 0\n    }\n  };\n  return {\n    ...ball,\n    invincible,\n    coord: {\n      x: coord.x + dx,\n      y: coord.y + dy,\n      dx,\n      dy\n    }\n  };\n};\nexport const clickEnd = state => _event => {\n  if (state.press) {\n    const t = (Date.now() - state.press.start) / 20000;\n    const dx = state.player.coord.x - state.press.pos.x;\n    const dy = state.player.coord.y - state.press.pos.y;\n    state.player.coord.dx = state.player.coord.dx + dx * t;\n    state.player.coord.dy = state.player.coord.dy + dy * t;\n    state.press = undefined;\n  }\n  return state;\n};\nexport const click = state => event => {\n  const {\n    offsetX: x,\n    offsetY: y\n  } = event;\n  state.press = {\n    start: Date.now(),\n    pos: {\n      x,\n      y\n    }\n  };\n  return state;\n};\nconst collide = (o1, o2) => dist2(o1, o2) < Math.pow(2 * conf.RADIUS, 2);\nconst collideBoing = (p1, p2) => {\n  const nx = (p2.x - p1.x) / (2 * conf.RADIUS);\n  const ny = (p2.y - p1.y) / (2 * conf.RADIUS);\n  const gx = -ny;\n  const gy = nx;\n  const v1g = gx * p1.dx + gy * p1.dy;\n  const v2n = nx * p2.dx + ny * p2.dy;\n  const v2g = gx * p2.dx + gy * p2.dy;\n  const v1n = nx * p1.dx + ny * p1.dy;\n  p1.dx = nx * v2n + gx * v1g;\n  p1.dy = ny * v2n + gy * v1g;\n  p2.dx = nx * v1n + gx * v2g;\n  p2.dy = ny * v1n + gy * v2g;\n  p1.x += p1.dx;\n  p1.y += p1.dy;\n  p2.x += p2.dx;\n  p2.y += p2.dy;\n};\nexport const step = state => {\n  state.pos.map((p1, i, arr) => {\n    arr.slice(i + 1).map(p2 => {\n      if (collide(p1.coord, p2.coord)) {\n        if (!p1.invincible) {\n          p1.life--;\n          p1.invincible = 20;\n        }\n        if (!p2.invincible) {\n          p2.life--;\n          p2.invincible = 20;\n        }\n        collideBoing(p1.coord, p2.coord);\n      }\n    });\n  });\n  document.addEventListener('keydown', event => {\n    var name = event.key;\n    console.log(state.joueur.pos.x + \" , \" + state.joueur.pos.y);\n    if (name == 'Z') {\n      return state.joueur.pos = perso.moveUp(state.joueur);\n    }\n    if (name == 'S') {\n      return state.joueur.pos = perso.moveDown(state.joueur);\n    }\n    if (name == 'Q') {\n      return state.joueur.pos = perso.moveLeft(state.joueur);\n    }\n    if (name == 'D') {\n      return state.joueur.pos = perso.moveRight(state.joueur);\n    } else {\n      return state.joueur.pos;\n    }\n  }, false);\n  if (state.player.invincible) state.player.invincible--;\n  state.pos.map((p1, i) => {\n    if (collide(p1.coord, state.player.coord)) {\n      collideBoing(p1.coord, state.player.coord);\n      if (!state.player.invincible) {\n        state.player.life--;\n        state.player.invincible = 20;\n      }\n      if (!p1.invincible) {\n        p1.life--;\n        p1.invincible = 20;\n      }\n    }\n  });\n  return {\n    ...state,\n    player: iterate(state.joueur)(state.size)(state.player),\n    pos: state.pos.map(iterate(state.joueur)(state.size)).filter(p => p.life > 0)\n  };\n};\nexport const mouseMove = state => event => {\n  return state;\n};\nexport const endOfGame = state => state.player.life > 0 && state.pos.length > 0;","map":{"version":3,"names":["conf","perso","dist2","o1","o2","Math","pow","x","y","iterate","player","bound","ball","invincible","coord","dx","RADIUS","width","FRICTION","dy","height","abs","MINMOVE","clickEnd","state","_event","press","t","Date","now","start","pos","undefined","click","event","offsetX","offsetY","collide","collideBoing","p1","p2","nx","ny","gx","gy","v1g","v2n","v2g","v1n","step","map","i","arr","slice","life","document","addEventListener","name","key","console","log","joueur","moveUp","moveDown","moveLeft","moveRight","size","filter","p","mouseMove","endOfGame","length"],"sources":["/users/nfs/Vrac/TME7CPAYANIS/proj/CPA/src/components/canvas/state.ts"],"sourcesContent":["import * as conf from './conf'\nimport * as perso from './game'\n\ntype Player = perso.Player\ntype CoordJoueur = perso.Coord\n\ntype Coord = { x: number; y: number; dx: number; dy: number }\ntype Ball = { coord: Coord; life: number; invincible?: number }\ntype Size = { height: number; width: number }\nexport type State = {\n  pos: Array<Ball>\n  press?: { start: number; pos: { x: number; y: number } }\n  size: Size\n  player: Ball\n  endOfGame: boolean\n  joueur : Player\n}\n\nconst dist2 = (o1: Coord, o2: Coord) =>\n  Math.pow(o1.x - o2.x, 2) + Math.pow(o1.y - o2.y, 2)\n\nconst iterate =\n  (player: Player) =>\n  (bound: Size) =>\n  (ball: Ball): Ball => {\n    const invincible = ball.invincible ? ball.invincible - 1 : ball.invincible\n    const coord = ball.coord\n    const dx =\n      (coord.x + conf.RADIUS > bound.width || coord.x < conf.RADIUS\n        ? -coord.dx\n        : coord.dx) * conf.FRICTION\n    const dy =\n      (coord.y + conf.RADIUS > bound.height || coord.y < conf.RADIUS\n        ? -coord.dy\n        : coord.dy) * conf.FRICTION\n    if (Math.abs(dx) + Math.abs(dy) < conf.MINMOVE)\n      return { ...ball, invincible, coord: { ...coord, dx: 0, dy: 0 } }\n    return {\n      ...ball,\n      invincible,\n      coord: {\n        x: coord.x + dx,\n        y: coord.y + dy,\n        dx,\n        dy,\n      },\n    }\n  }\n\nexport const clickEnd =\n  (state: State) =>\n  (_event: PointerEvent): State => {\n    if (state.press) {\n      const t = (Date.now() - state.press.start) / 20000\n      const dx = state.player.coord.x - state.press.pos.x\n      const dy = state.player.coord.y - state.press.pos.y\n      state.player.coord.dx = state.player.coord.dx + dx * t\n      state.player.coord.dy = state.player.coord.dy + dy * t\n      state.press = undefined\n    }\n    return state\n  }\n\nexport const click =\n  (state: State) =>\n  (event: PointerEvent): State => {\n    const { offsetX: x, offsetY: y } = event\n    state.press = { start: Date.now(), pos: { x, y } }\n    return state\n  }\n\nconst collide = (o1: Coord, o2: Coord) =>\n  dist2(o1, o2) < Math.pow(2 * conf.RADIUS, 2)\n\nconst collideBoing = (p1: Coord, p2: Coord) => {\n  const nx = (p2.x - p1.x) / (2 * conf.RADIUS)\n  const ny = (p2.y - p1.y) / (2 * conf.RADIUS)\n  const gx = -ny\n  const gy = nx\n\n  const v1g = gx * p1.dx + gy * p1.dy\n  const v2n = nx * p2.dx + ny * p2.dy\n  const v2g = gx * p2.dx + gy * p2.dy\n  const v1n = nx * p1.dx + ny * p1.dy\n  p1.dx = nx * v2n + gx * v1g\n  p1.dy = ny * v2n + gy * v1g\n  p2.dx = nx * v1n + gx * v2g\n  p2.dy = ny * v1n + gy * v2g\n  p1.x += p1.dx\n  p1.y += p1.dy\n  p2.x += p2.dx\n  p2.y += p2.dy\n}\n\nexport const step = (state: State) => {\n  state.pos.map((p1, i, arr) => {\n    arr.slice(i + 1).map((p2) => {\n      if (collide(p1.coord, p2.coord)) {\n        if (!p1.invincible) {\n          p1.life--\n          p1.invincible = 20\n        }\n        if (!p2.invincible) {\n          p2.life--\n          p2.invincible = 20\n        }\n        collideBoing(p1.coord, p2.coord)\n      }\n    })\n  })\n  document.addEventListener('keydown', (event) => {\n    var name = event.key;\n\n    \n    console.log(state.joueur.pos.x + \" , \" +state.joueur.pos.y);\n    if(name=='Z'){\n      return state.joueur.pos = perso.moveUp(state.joueur)\n    }\n    if(name=='S'){\n       return state.joueur.pos=perso.moveDown(state.joueur)\n    }\n    if(name=='Q'){\n       return state.joueur.pos= perso.moveLeft(state.joueur)\n    }\n    if(name=='D'){\n       return state.joueur.pos= perso.moveRight(state.joueur)\n    }\n    else{\n       return state.joueur.pos\n    }\n\n  }, false);\n\n  if (state.player.invincible) state.player.invincible--\n  state.pos.map((p1, i) => {\n    if (collide(p1.coord, state.player.coord)) {\n      collideBoing(p1.coord, state.player.coord)\n      if (!state.player.invincible) {\n        state.player.life--\n        state.player.invincible = 20\n      }\n      if (!p1.invincible) {\n        p1.life--\n        p1.invincible = 20\n      }\n    }\n  })\n  return {\n    ...state,\n    player: iterate(state.joueur)(state.size)(state.player),\n    pos: state.pos.map(iterate(state.joueur)(state.size)).filter((p) => p.life > 0),\n  }\n}\n\nexport const mouseMove =\n  (state: State) =>\n  (event: PointerEvent): State => {\n    return state\n  }\n\nexport const endOfGame = (state: State): boolean =>\n  state.player.life > 0 && state.pos.length > 0\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}