{"ast":null,"code":"var _jsxFileName = \"/home/yanis/FAC/CPAProjet/canvas/src/components/canvas/index.tsx\",\n  _s = $RefreshSig$();\nimport * as conf from './conf';\nimport { useRef, useEffect } from 'react';\nimport { step, click, mouseMove, endOfGame } from './state';\nimport { render } from './renderer';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst randomInt = max => Math.floor(Math.random() * max);\nconst randomSign = () => Math.sign(Math.random() - 0.5);\nconst initCanvas = iterate => canvas => {\n  const ctx = canvas.getContext('2d');\n  if (!ctx) return;\n  requestAnimationFrame(() => iterate(ctx));\n};\nconst Canvas = _ref => {\n  _s();\n  let {\n    height,\n    width\n  } = _ref;\n  const initialState = {\n    pos: new Array(2).fill(1).map(_ => ({\n      life: conf.BALLLIFE,\n      coord: {\n        x: randomInt(width - 120) + 60,\n        y: randomInt(height - 120) + 60,\n        dx: 4 * randomSign(),\n        dy: 4 * randomSign()\n      }\n    })),\n    size: {\n      height,\n      width\n    },\n    endOfGame: true\n  };\n  const ref = useRef();\n  const state = useRef(initialState);\n  const iterate = ctx => {\n    state.current = step(state.current);\n    state.current.endOfGame = !endOfGame(state.current);\n    render(ctx)(state.current);\n    if (!state.current.endOfGame) requestAnimationFrame(() => iterate(ctx));\n  };\n  const onClick = e => {\n    state.current = click(state.current)(e);\n  };\n  const onMove = e => {\n    state.current = mouseMove(state.current)(e);\n  };\n  useEffect(() => {\n    if (ref.current) {\n      initCanvas(iterate)(ref.current);\n      ref.current.addEventListener('click', onClick);\n      ref.current.addEventListener('mousemove', onMove);\n    }\n    return () => {\n      ref.current.removeEventListener('click', onMove);\n      ref.current.removeEventListener('mousemove', onMove);\n    };\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"canvas\", {\n    height,\n    width,\n    ref\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 59,\n    columnNumber: 10\n  }, this);\n};\n_s(Canvas, \"Gpm0P4FfDB25XYapIJctmdb7SaA=\");\n_c = Canvas;\nexport default Canvas;\nvar _c;\n$RefreshReg$(_c, \"Canvas\");","map":{"version":3,"names":["conf","useRef","useEffect","step","click","mouseMove","endOfGame","render","jsxDEV","_jsxDEV","randomInt","max","Math","floor","random","randomSign","sign","initCanvas","iterate","canvas","ctx","getContext","requestAnimationFrame","Canvas","_ref","_s","height","width","initialState","pos","Array","fill","map","_","life","BALLLIFE","coord","x","y","dx","dy","size","ref","state","current","onClick","e","onMove","addEventListener","removeEventListener","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/home/yanis/FAC/CPAProjet/canvas/src/components/canvas/index.tsx"],"sourcesContent":["import * as conf from './conf'\nimport { useRef, useEffect } from 'react'\nimport { State, step, click, mouseMove, endOfGame } from './state'\nimport { render } from './renderer'\n\nconst randomInt = (max: number) => Math.floor(Math.random() * max)\nconst randomSign = () => Math.sign(Math.random() - 0.5)\n\nconst initCanvas =\n  (iterate: (ctx: CanvasRenderingContext2D) => void) =>\n  (canvas: HTMLCanvasElement) => {\n    const ctx = canvas.getContext('2d')\n    if (!ctx) return\n    requestAnimationFrame(() => iterate(ctx))\n  }\n\nconst Canvas = ({ height, width }: { height: number; width: number }) => {\n  const initialState: State = {\n    pos: new Array(2).fill(1).map((_) => ({\n      life: conf.BALLLIFE,\n      coord: {\n        x: randomInt(width - 120) + 60,\n        y: randomInt(height - 120) + 60,\n        dx: 4 * randomSign(),\n        dy: 4 * randomSign(),\n      },\n    })),\n    size: { height, width },\n    endOfGame: true,\n  }\n\n  const ref = useRef<any>()\n  const state = useRef<State>(initialState)\n\n  const iterate = (ctx: CanvasRenderingContext2D) => {\n    state.current = step(state.current)\n    state.current.endOfGame = !endOfGame(state.current)\n    render(ctx)(state.current)\n    if (!state.current.endOfGame) requestAnimationFrame(() => iterate(ctx))\n  }\n  const onClick = (e: PointerEvent) => {\n    state.current = click(state.current)(e)\n  }\n\n  const onMove = (e: PointerEvent) => {\n    state.current = mouseMove(state.current)(e)\n  }\n  useEffect(() => {\n    if (ref.current) {\n      initCanvas(iterate)(ref.current)\n      ref.current.addEventListener('click', onClick)\n      ref.current.addEventListener('mousemove', onMove)\n    }\n    return () => {\n      ref.current.removeEventListener('click', onMove)\n      ref.current.removeEventListener('mousemove', onMove)\n    }\n  }, [])\n  return <canvas {...{ height, width, ref }} />\n}\n\nexport default Canvas\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}